# gdbg  

<img 
  src="assets/gdbg_logo.png" 
  width="80"
  alt="red blood drop with text 'gdbg' centered"
/>

## overview

> gdbg: *get dexcom blood glucose*

a python app that displays blood glucose in the macos menu bar. retrieves blood glucose from dexcom via the [pydexcom](https://github.com/gagebenne/pydexcom) library. it also writes the blood glucose and trend arrow (with terminal colors) to a state file that can be used for displaying data in your terminal. there is also a version that can be run on linux (used on pop_os) as a service to update the state files for use in the terminal.

this app was inspired by [kylebshr/luka-mini](https://github.com/kylebshr/luka-mini/tree/main). this is a __fantastic__ app and would recommend for people who want a seamless app experience. i wanted to be able to access the blood glucose data outside of the app for other uses.

## how to use

### file resources

all resources are in the directory: `$HOME/.dexcom`

#### secrets file

this file must be created manually

* `dexcom_credentials.json`

```json
{
  "username" : "dexcom_username",
  "password": "dexcom_password"
}
```

#### blood glucose state files

these files are generated by the app

* `bg_status.txt`
* `bg_color_status.txt`

### build app

TODO: note that this needs to be built in conda env with everything installed (so maybe dev section doesn't need to exist...)

```sh
python setup.py py2app
```

### add to macos login items

TODO: how to

## development

NOTE: using [anaconda](https://gist.github.com/ryanorsinger/7d89ad58901b5590ec3e1f23d7b9f887) on macos

```sh
conda create --name gdbg python=3.11
conda activate gdbg  

pip uninstall setuptools # need an older version
pip install --no-cache-dir -r requirements.txt 
```

### known issues

TODO: more here (text explaining)

```sh
# solution if issue with `@rpath/libffi.8.dylib`
ln -sf /opt/homebrew/opt/libffi/lib/libffi.8.dylib /usr/local/lib/

# DEBUG
dist/gdbg.app/Contents/MacOS/gdbg
```

TODO: issue with newer setup tools in python 3.12: https://github.com/ronaldoussoren/py2app/issues/531

## using in zsh $PROMPT

to use in zsh prompt, update `$PROMPT` in `$HOME/.zshrc`. the backslash when setting `$PROMPT` to execute the function to read the bg text file is __critical__ (will not work otherwise).

```sh
# $HOME/.zshrc

function get_bg() {
    cat $HOME/.dexcom/bg_color_status.txt
}

export PROMPT="$PROMPT\$(get_bg)"
```

## credits

*assets*

* logo by [izzy bulling - @izval](https://www.instagram.com/izval/)
* [modak](https://github.com/EkType/Modak) font used in logo

*packages*

* [gagebenne/pydexacom](https://github.com/gagebenne/pydexcom)
* [jaredks/rumps](https://github.com/jaredks/rumps)
* [dante-biase/py2app](https://github.com/dante-biase/py2app)
* [python-trio/trio](https://github.com/python-trio/trio)

## references

* [kylebshr/luka-mini](https://github.com/kylebshr/luka-mini/tree/main)
* [Create a macOS Menu Bar App with Python (Pomodoro Timer) - Camillo Visini](https://camillovisini.com/coding/create-macos-menu-bar-app-pomodoro)
* [Glucose Readings in a Terminal Prompt - Hart Hoover](https://harthoover.com/glucose-readings-in-a-terminal-prompt/)

## TODO:

__(1)__

* [ ] for timer, add logic if time has passed... may cause crash or infinite calls...
* [ ] needs to check previous timestamp before making call
  * [ ] then retry every minute
  * [ ] if `None`, then what...
* [ ] have it update time since last check

__(2)__

* [ ] refresh login session id if it fails
  * pydexcom does this here: https://github.com/gagebenne/pydexcom/blob/9bd35b2597513ba6e13ce4e3211a0e8f6517cf33/pydexcom/__init__.py#L341 
* [ ] show delta (+/-)
  * will need to store previous reading

__(3)__

* [ ] have it start as login item
* [ ] add images to README for:
  * [ ] menu bar app
  * [ ] cli prompt
* [ ] have final app build to applications dir?

__(4)__

* [ ] notification on low? (ability to toggle?)
* [ ] color the menu bar (tis a hack)
  * https://www.phind.com/search?cache=kx66qmtzfex8yzqy2ko0vgup 
* [ ] linux version
